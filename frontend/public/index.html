<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Blockchain-Based Agricultural Produce Tracking System" />
    <title>Agricultural Produce Tracking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem 1rem;
            color: white;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .search-section {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .search-section h2 {
            margin-bottom: 1.5rem;
            font-weight: 300;
            color: #333;
        }

        .input-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .produce-input {
            padding: 0.75rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
            min-width: 200px;
            transition: border-color 0.3s;
        }

        .produce-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e1e5e9;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .error-message {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 0.75rem;
            margin-top: 1rem;
        }

        .produce-details {
            margin-top: 2rem;
            text-align: left;
        }

        .produce-details h3 {
            margin-bottom: 1rem;
            text-align: center;
            color: #333;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .detail-item strong {
            color: #333;
        }

        .info-section {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .info-section h2 {
            margin-bottom: 1.5rem;
            font-weight: 300;
            color: #333;
        }

        .workflow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .step {
            text-align: left;
        }

        .step h4 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .step p {
            color: #666;
            line-height: 1.5;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .input-group {
                flex-direction: column;
            }

            .produce-input {
                min-width: 100%;
            }

            .workflow {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Agricultural Produce Tracking System</h1>
        <p>Blockchain-based transparent supply chain tracking</p>
    </div>

    <div class="container">
        <div class="search-section">
            <h2>Verify Produce</h2>
            <div class="input-group">
                <input
                    type="text"
                    id="produceId"
                    placeholder="Enter Produce ID"
                    class="produce-input"
                />
                <button onclick="verifyProduce()" id="verifyBtn" class="btn btn-primary">
                    Verify
                </button>
                <button onclick="generateQR()" class="btn btn-secondary">
                    Generate QR
                </button>
            </div>

            <div id="errorMessage" class="error-message" style="display: none;"></div>

            <div id="produceDetails" class="produce-details" style="display: none;">
                <h3>Produce Details</h3>
                <div class="details-grid" id="detailsGrid">
                    <!-- Details will be populated here -->
                </div>
            </div>
        </div>

        <div class="info-section">
            <h2>How It Works</h2>
            <div class="workflow">
                <div class="step">
                    <h4>1. Farmers Register Produce</h4>
                    <p>Farmers register their produce with origin, quality, and pricing information on the blockchain.</p>
                </div>
                <div class="step">
                    <h4>2. Distributors Track Movement</h4>
                    <p>Distributors log transfer information and update storage conditions.</p>
                </div>
                <div class="step">
                    <h4>3. Retailers Set Prices</h4>
                    <p>Retailers update pricing and generate QR codes for consumer verification.</p>
                </div>
                <div class="step">
                    <h4>4. Consumers Verify</h4>
                    <p>Consumers scan QR codes to view complete produce history and verify authenticity.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function verifyProduce() {
            const produceId = document.getElementById('produceId').value;
            const verifyBtn = document.getElementById('verifyBtn');
            const errorDiv = document.getElementById('errorMessage');
            const detailsDiv = document.getElementById('produceDetails');
            const detailsGrid = document.getElementById('detailsGrid');

            if (!produceId) {
                showError('Please enter a Produce ID');
                return;
            }

            verifyBtn.innerHTML = '<div class="loading"></div> Loading...';
            verifyBtn.disabled = true;
            errorDiv.style.display = 'none';
            detailsDiv.style.display = 'none';

            try {
                const response = await fetch(`http://localhost:3001/api/produce/${produceId}`);
                const data = await response.json();

                if (response.ok) {
                    displayProduceDetails(data);
                } else {
                    showError(data.error || 'Failed to fetch produce data');
                }
            } catch (error) {
                showError('Network error. Please check if the backend is running.');
            }

            verifyBtn.innerHTML = 'Verify';
            verifyBtn.disabled = false;
        }

        async function generateQR() {
            const produceId = document.getElementById('produceId').value;

            if (!produceId) {
                showError('Please enter a Produce ID');
                return;
            }

            try {
                const response = await fetch(`http://localhost:3001/api/qr/${produceId}`);
                const data = await response.json();

                if (response.ok) {
                    alert('QR code generated successfully! In a real application, this would display the QR code.');
                } else {
                    showError(data.error || 'Failed to generate QR code');
                }
            } catch (error) {
                showError('Network error. Please check if the backend is running.');
            }
        }

        function displayProduceDetails(data) {
            const detailsGrid = document.getElementById('detailsGrid');
            const detailsDiv = document.getElementById('produceDetails');

            detailsGrid.innerHTML = `
                <div class="detail-item">
                    <strong>ID:</strong> ${data.id || 'N/A'}
                </div>
                <div class="detail-item">
                    <strong>Farmer:</strong> ${data.farmer || 'N/A'}
                </div>
                <div class="detail-item">
                    <strong>Origin:</strong> ${data.origin || 'N/A'}
                </div>
                <div class="detail-item">
                    <strong>Quality:</strong> ${data.quality || 'N/A'}
                </div>
                <div class="detail-item">
                    <strong>Price:</strong> ${data.initialPrice || 'N/A'} ETH
                </div>
                <div class="detail-item">
                    <strong>Timestamp:</strong> ${data.timestamp ? new Date(data.timestamp * 1000).toLocaleString() : 'N/A'}
                </div>
                <div class="detail-item">
                    <strong>Status:</strong> ${data.isActive ? 'Active' : 'Inactive'}
                </div>
            `;

            detailsDiv.style.display = 'block';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Allow Enter key to trigger verification
        document.getElementById('produceId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyProduce();
            }
        });
    </script>
</body>
</html>
